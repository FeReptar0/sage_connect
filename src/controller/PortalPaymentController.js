function _0x3345(){const _0x4fb434=['2344364xEZvsI','Se\x20ejecuto\x20correctamente\x20el\x20proceso\x20de\x20alta\x20de\x20pagos\x20en\x20portal,\x20para\x20la\x20compañia\x20','error','\x20con\x20el\x20NoPagoSage\x20','../utils/SQLServerConnection','/payments','.env.credentials.focaltec','operation_type','Error\x20al\x20ejecutar\x20la\x20peticion\x20POST\x20de\x20pagos\x20','1738620jqCLZj','Error\x20al\x20enviar\x20el\x20correo\x20de\x20alta\x20de\x20pagos\x20en\x20portal\x20','splice','replace','bk_currency','6slDjVX','success','dotenv','SELECT\x20A.*\x20FROM\x20(SELECT\x20P.CNTBTCH\x20as\x20LotePago,\x20P.CNTENTR\x20as\x20AsientoPago,\x20RTRIM(BK.ADDR1)\x20AS\x20bank_account_id,\x20B.IDBANK,\x20P.DATEBUS\x20as\x20FechaAsentamiento\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20P.DOCNBR\x20as\x20external_id,P.TEXTRMIT\x20AS\x20comments,\x20P.TXTRMITREF\x20AS\x20reference\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20CASE\x20BK.CURNSTMT\x20WHEN\x20\x27MXP\x27\x20THEN\x20\x27MXN\x27\x20ELSE\x20BK.CURNSTMT\x20END\x20AS\x20bk_currency\x0a\x20\x20\x20\x20\x20\x20\x20\x20,P.DATERMIT\x20as\x20payment_date,\x20RTRIM(P.IDVEND)\x20as\x20provider_external_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20P.AMTRMIT\x20as\x20total_amount\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20\x27TRANSFER\x27\x20as\x20operation_type\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20P.RATEEXCHHC\x20as\x20TipoCambioPago\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20ISNULL((SELECT\x20[VALUE]\x20FROM\x20APVENO\x20WHERE\x20OPTFIELD\x20=\x27RFC\x27\x20AND\x20VENDORID\x20=\x20P.IDVEND\x20),\x27\x27)\x20AS\x20RFC\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20ISNULL((SELECT\x20[VALUE]\x20FROM\x20APVENO\x20WHERE\x20OPTFIELD\x20=\x27PROVIDERID\x27\x20AND\x20VENDORID\x20=\x20P.IDVEND\x20),\x27\x27)\x20AS\x20PROVIDERID\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20APBTA\x20B,\x20BKACCT\x20BK,\x20APTCR\x20P\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20B.IDBANK\x20=\x20BK.BANK\x20\x20AND\x20B.PAYMTYPE\x20=\x20P.BTCHTYPE\x20AND\x20B.CNTBTCH\x20=\x20P.CNTBTCH\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20P.ERRENTRY\x20=\x200\x20AND\x20P.RMITTYPE\x20=\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20B.PAYMTYPE=\x27PY\x27\x20AND\x20B.BATCHSTAT\x20=\x203\x20AND\x20P.DATEBUS>=','SELECT\x20NoPagoSage\x20FROM\x20fesa.dbo.fesaPagosFocaltec','toISOString','NoPagoSage','exports','axios','Alta\x20de\x20pagos\x20en\x20portal','catch','LotePago','../utils/EmailSender','T10:00:00.000Z','reference','No\x20se\x20ejecuto\x20el\x20proceso:\x20','slice','Error\x20al\x20ejecutar\x20la\x20consulta\x20de\x20pagos\x20queryEncabezadosPago\x20','No\x20hay\x20facturas\x20pagadas\x20para\x20subir\x20a\x20portal','UUID','length','external_id','rowsAffected','/public/img/cerrar.png','INSERT\x20INTO\x20fesa.dbo.fesaPagosFocaltec\x20(idCia,\x20NoPagoSage)\x20VALUES\x20(\x27','6XUFHqR','provider_external_id','notify','Se\x20ejecuto\x20el\x20proceso\x20de\x20alta\x20de\x20pagos\x20en\x20portal,\x20para\x20la\x20compañia\x20','data','bank_account_id','909wAYVup','recordset','../utils/LogGenerator','parsed','log','No\x20se\x20ejecuto\x20el\x20proceso\x20de\x20alta\x20de\x20pagos\x20en\x20portal,\x20para\x20la\x20compañia\x20','payment_amount','Error\x20al\x20ejecutar\x20el\x20proceso\x20de\x20alta\x20de\x20pagos\x20en\x20portal','50QpLpLH','\x27,\x20\x27','\x20AND\x20DP.CNTRMIT\x20=\x20','payment_date','comments','32632xioCIl','PortalPaymentController','node-notifier','SELECT\x20DP.CNTBTCH\x20as\x20LotePago,DP.CNTRMIT\x20as\x20AsientoPago,\x20\x20RTRIM(DP.IDVEND)\x20as\x20IDVEND,\x20RTRIM(DP.IDINVC)\x20AS\x20IDINVC,\x20H.AMTGROSDST\x20AS\x20invoice_amount,\x20DP.DOCTYPE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,\x20CASE\x20H.CODECURN\x20WHEN\x20\x27MXP\x27\x20THEN\x20\x27MXN\x27\x20ELSE\x20H.CODECURN\x20END\x20AS\x20invoice_currency\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,\x20H.EXCHRATEHC\x20\x20AS\x20invoice_exchange_rate\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,\x20DP.AMTPAYM\x20\x20AS\x20payment_amount\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,\x20ISNULL((SELECT\x20RTRIM([VALUE])\x20FROM\x20APIBHO\x20\x20WHERE\x20CNTBTCH\x20=\x20H.CNTBTCH\x20\x20AND\x20CNTITEM\x20=\x20H.CNTITEM\x20AND\x20OPTFIELD\x20=\x20\x27FOLIOCFD\x27),\x27\x27)\x20AS\x20UUID\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20APTCP\x20DP\x20,\x20APIBH\x20H,\x20APIBC\x20C\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20DP.BATCHTYPE\x20=\x27PY\x27\x20AND\x20DP.CNTBTCH=\x20','Error\x20al\x20ejecutar\x20el\x20proceso\x20de\x20alta\x20de\x20pagos\x20en\x20portal\x20','status','Error\x20al\x20ejecutar\x20la\x20consulta\x20de\x20pagos\x20queryPagosRegistrados\x20','No\x20hay\x20pagos\x20para\x20subir\x20a\x20portal','/api/1.0/extern/tenants/','159348heAoxe','split','Se\x20inserto\x20correctamente\x20el\x20pago\x20en\x20la\x20tabla\x20fesaPagosFocaltec','API_KEY','132VETgxA','No\x20se\x20inserto\x20el\x20pago\x20en\x20la\x20tabla\x20fesaPagosFocaltec','push','URL','AsientoPago','12836894vFBuAK','DATABASES','9121670UQwtRC','9ywMyio','Error\x20al\x20ejecutar\x20la\x20insercion\x20de\x20pagos\x20en\x20fesaPagosFocaltec\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20P.DOCNBR\x20NOT\x20IN\x20(SELECT\x20NoPagoSage\x20FROM\x20fesa.dbo.fesaPagosFocaltec\x20WHERE\x20idCia\x20=\x20P.AUDTORG\x20AND\x20\x20NoPagoSage\x20=\x20P.DOCNBR\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20P.DOCNBR\x20NOT\x20IN\x20(SELECT\x20IDINVC\x20FROM\x20APPYM\x20WHERE\x20IDBANK\x20=\x20B.IDBANK\x20AND\x20CNTBTCH\x20=\x20P.CNTBTCH\x20AND\x20CNTITEM\x20=P.CNTENTR\x20AND\x20SWCHKCLRD\x20=\x202\x20))\x20AS\x20A\x20WHERE\x20PROVIDERID\x20<>\x20\x27\x27','invoice_currency','config','API_SECRET','916591DYJtsW'];_0x3345=function(){return _0x4fb434;};return _0x3345();}function _0x5802(_0x8a49b0,_0x46e396){const _0x3345ff=_0x3345();return _0x5802=function(_0x5802fd,_0x50960c){_0x5802fd=_0x5802fd-0xd9;let _0x5c2b8f=_0x3345ff[_0x5802fd];return _0x5c2b8f;},_0x5802(_0x8a49b0,_0x46e396);}const _0x1f3e27=_0x5802;(function(_0x24afc7,_0x4c7070){const _0x326973=_0x5802,_0x1caec3=_0x24afc7();while(!![]){try{const _0x3d2b18=parseInt(_0x326973(0xdc))/0x1*(-parseInt(_0x326973(0xfd))/0x2)+parseInt(_0x326973(0xe8))/0x3*(parseInt(_0x326973(0xf8))/0x4)+-parseInt(_0x326973(0xe7))/0x5+-parseInt(_0x326973(0x116))/0x6*(-parseInt(_0x326973(0xe5))/0x7)+parseInt(_0x326973(0x129))/0x8*(parseInt(_0x326973(0x11c))/0x9)+parseInt(_0x326973(0x124))/0xa*(-parseInt(_0x326973(0xef))/0xb)+-parseInt(_0x326973(0xe0))/0xc*(-parseInt(_0x326973(0xee))/0xd);if(_0x3d2b18===_0x4c7070)break;else _0x1caec3['push'](_0x1caec3['shift']());}catch(_0x3225b1){_0x1caec3['push'](_0x1caec3['shift']());}}}(_0x3345,0xe9bb5));const {runQuery}=require(_0x1f3e27(0xf3)),{sendMail}=require(_0x1f3e27(0x109)),axios=require(_0x1f3e27(0x105)),notifier=require(_0x1f3e27(0x12b)),dotenv=require(_0x1f3e27(0xff)),credentials=dotenv[_0x1f3e27(0xec)]({'path':_0x1f3e27(0xf5)}),{logGenerator}=require(_0x1f3e27(0x11e)),database=[],tenantIds=[],apiKeys=[],apiSecrets=[],url=credentials['parsed'][_0x1f3e27(0xe3)],tenantIdValues=credentials['parsed']['TENANT_ID'][_0x1f3e27(0xdd)](','),apiKeyValues=credentials['parsed'][_0x1f3e27(0xdf)][_0x1f3e27(0xdd)](','),apiSecretValues=credentials[_0x1f3e27(0x11f)][_0x1f3e27(0xed)][_0x1f3e27(0xdd)](','),databaseValues=credentials[_0x1f3e27(0x11f)][_0x1f3e27(0xe6)][_0x1f3e27(0xdd)](',');tenantIds[_0x1f3e27(0xe2)](...tenantIdValues),apiKeys[_0x1f3e27(0xe2)](...apiKeyValues),apiSecrets[_0x1f3e27(0xe2)](...apiSecretValues),database['push'](...databaseValues);async function uploadPayments(_0x370e7a){const _0x2fbd06=_0x1f3e27;try{const _0x333e5f=new Date()[_0x2fbd06(0x102)]()[_0x2fbd06(0x10d)](0x0,0xa)[_0x2fbd06(0xfb)](/-/g,''),_0x5603eb=_0x2fbd06(0x100)+_0x333e5f+_0x2fbd06(0xea),_0x17f4b6=await runQuery(_0x5603eb,database[_0x370e7a])[_0x2fbd06(0x107)](_0x2e9124=>{const _0x5e435b=_0x2fbd06;return console['log'](_0x2e9124),logGenerator(_0x5e435b(0x12a),'error',_0x5e435b(0x10e)+_0x2e9124),{'recordset':[]};}),_0x425a43=_0x2fbd06(0x101),_0x293338=await runQuery(_0x425a43)[_0x2fbd06(0x107)](_0x5416a9=>{const _0x185476=_0x2fbd06;return console[_0x185476(0x120)](_0x5416a9),logGenerator(_0x185476(0x12a),_0x185476(0xf1),_0x185476(0xd9)+_0x5416a9),{'recordset':[]};});if(_0x293338[_0x2fbd06(0x11d)][_0x2fbd06(0x111)]>0x0)for(let _0x34e9a4=0x0;_0x34e9a4<_0x293338[_0x2fbd06(0x11d)][_0x2fbd06(0x111)];_0x34e9a4++){for(let _0x1be2f8=0x0;_0x1be2f8<_0x17f4b6[_0x2fbd06(0x11d)][_0x2fbd06(0x111)];_0x1be2f8++){_0x293338['recordset'][_0x34e9a4][_0x2fbd06(0x103)]===_0x17f4b6[_0x2fbd06(0x11d)][_0x1be2f8]['external_id']&&_0x17f4b6[_0x2fbd06(0x11d)][_0x2fbd06(0xfa)](_0x1be2f8,0x1);}}if(_0x17f4b6[_0x2fbd06(0x11d)][_0x2fbd06(0x111)]>0x0)for(let _0x36b0d7=0x0;_0x36b0d7<_0x17f4b6[_0x2fbd06(0x11d)]['length'];_0x36b0d7++){const _0x555e3d=[],_0xfbfef6=_0x2fbd06(0x12c)+_0x17f4b6['recordset'][_0x36b0d7][_0x2fbd06(0x108)]+_0x2fbd06(0x126)+_0x17f4b6[_0x2fbd06(0x11d)][_0x36b0d7][_0x2fbd06(0xe4)]+'\x20AND\x20DP.DOCTYPE\x20=\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20H.ORIGCOMP=\x27\x27\x20AND\x20DP.IDVEND\x20=\x20H.IDVEND\x20\x20AND\x20DP.IDINVC\x20=\x20H.IDINVC\x20\x20AND\x20H.ERRENTRY\x20=\x200\x20AND\x20H.CNTBTCH\x20=\x20C.CNTBTCH\x20AND\x20C.BTCHSTTS\x20=\x203',_0xb8d5bb=await runQuery(_0xfbfef6,database[_0x370e7a])[_0x2fbd06(0x107)](_0x1f75d4=>{return console['log'](_0x1f75d4),logGenerator('PortalPaymentController','error','Error\x20al\x20ejecutar\x20la\x20consulta\x20de\x20pagos\x20queryFacturasPagadas\x20'+_0x1f75d4),{'recordset':[]};});if(_0xb8d5bb[_0x2fbd06(0x11d)][_0x2fbd06(0x111)]>0x0){for(let _0x205ec7=0x0;_0x205ec7<_0xb8d5bb[_0x2fbd06(0x11d)][_0x2fbd06(0x111)];_0x205ec7++){const _0x18236e={'amount':_0xb8d5bb[_0x2fbd06(0x11d)][_0x205ec7][_0x2fbd06(0x122)],'currency':_0xb8d5bb[_0x2fbd06(0x11d)][_0x205ec7][_0x2fbd06(0xeb)],'exchange_rate':_0xb8d5bb['recordset'][_0x205ec7]['invoice_exchange_rate'],'payment_amount':_0xb8d5bb[_0x2fbd06(0x11d)][_0x205ec7][_0x2fbd06(0x122)],'payment_currency':_0x17f4b6[_0x2fbd06(0x11d)][_0x36b0d7]['bk_currency'],'uuid':_0xb8d5bb[_0x2fbd06(0x11d)][_0x205ec7][_0x2fbd06(0x110)]};_0x555e3d[_0x2fbd06(0xe2)](_0x18236e);}const _0x240769=_0x17f4b6[_0x2fbd06(0x11d)][_0x36b0d7][_0x2fbd06(0x127)]['toString'](),_0xe973ac=_0x240769[_0x2fbd06(0x10d)](0x0,0x4)+'-'+_0x240769['slice'](0x4,0x6)+'-'+_0x240769[_0x2fbd06(0x10d)](0x6,0x8)+_0x2fbd06(0x10a),_0x57d3e7={'bank_account_id':_0x17f4b6[_0x2fbd06(0x11d)][_0x36b0d7][_0x2fbd06(0x11b)],'cfdis':_0x555e3d,'comments':_0x17f4b6[_0x2fbd06(0x11d)][_0x36b0d7][_0x2fbd06(0x128)],'currency':_0x17f4b6['recordset'][_0x36b0d7][_0x2fbd06(0xfc)],'external_id':_0x17f4b6[_0x2fbd06(0x11d)][_0x36b0d7][_0x2fbd06(0x112)],'ignore_amounts':![],'mark_existing_cfdi_as_payed':!![],'open':![],'operation_type':_0x17f4b6[_0x2fbd06(0x11d)][_0x36b0d7][_0x2fbd06(0xf6)],'payment_date':_0xe973ac,'provider_external_id':_0x17f4b6[_0x2fbd06(0x11d)][_0x36b0d7][_0x2fbd06(0x117)],'reference':_0x17f4b6[_0x2fbd06(0x11d)][_0x36b0d7][_0x2fbd06(0x10b)],'total_amount':_0x17f4b6[_0x2fbd06(0x11d)][_0x36b0d7]['total_amount']},_0x5d7818=await axios['post'](url+_0x2fbd06(0xdb)+tenantIds[_0x370e7a]+_0x2fbd06(0xf4),_0x57d3e7,{'headers':{'PDPTenantKey':apiKeys[_0x370e7a],'PDPTenantSecret':apiSecrets[_0x370e7a]}})[_0x2fbd06(0x107)](_0x1bc152=>{const _0x44e800=_0x2fbd06;return console[_0x44e800(0x120)](_0x1bc152),logGenerator(_0x44e800(0x12a),_0x44e800(0xf1),_0x44e800(0xf7)+_0x1bc152),{'status':0x1f4,'data':_0x1bc152};});if(_0x5d7818[_0x2fbd06(0x12e)]===0xc8){const _0x4c8167='Se\x20ejecuto\x20correctamente\x20el\x20proceso\x20de\x20alta\x20de\x20pagos\x20en\x20portal,\x20para\x20la\x20compañia\x20'+database[_0x370e7a]+_0x2fbd06(0xf2)+_0x17f4b6[_0x2fbd06(0x11d)][_0x36b0d7][_0x2fbd06(0x112)],_0x57ecfd={'h1':'Alta\x20de\x20pagos\x20en\x20portal','p':_0x2fbd06(0x119)+database[_0x370e7a]+_0x2fbd06(0xf2)+_0x17f4b6[_0x2fbd06(0x11d)][_0x36b0d7][_0x2fbd06(0x112)],'status':_0x5d7818[_0x2fbd06(0x12e)],'message':_0x4c8167,'position':_0x370e7a,'idCia':database[_0x370e7a]};logGenerator(_0x2fbd06(0x12a),_0x2fbd06(0xfe),_0x2fbd06(0xf0)+database[_0x370e7a]+'\x20con\x20el\x20NoPagoSage\x20'+_0x17f4b6['recordset'][_0x36b0d7][_0x2fbd06(0x112)]),await sendMail(_0x57ecfd)[_0x2fbd06(0x107)](_0x294255=>{const _0x20ff4a=_0x2fbd06;console['log'](_0x294255),logGenerator(_0x20ff4a(0x12a),_0x20ff4a(0xf1),_0x20ff4a(0xf9)+_0x294255);});const _0x43cbc7=_0x2fbd06(0x115)+database[_0x370e7a]+_0x2fbd06(0x125)+_0x17f4b6['recordset'][_0x36b0d7][_0x2fbd06(0x112)]+'\x27)',_0x3d1d01=await runQuery(_0x43cbc7)[_0x2fbd06(0x107)](_0x57e4da=>{const _0x420eff=_0x2fbd06;return console[_0x420eff(0x120)](_0x57e4da),logGenerator(_0x420eff(0x12a),_0x420eff(0xf1),_0x420eff(0xe9)+_0x57e4da),{'rowsAffected':[0x0]};});_0x3d1d01[_0x2fbd06(0x113)][0x0]>0x0?(console[_0x2fbd06(0x120)](_0x2fbd06(0xde)),logGenerator(_0x2fbd06(0x12a),_0x2fbd06(0xfe),_0x2fbd06(0xde))):(console[_0x2fbd06(0x120)](_0x2fbd06(0xe1)),logGenerator(_0x2fbd06(0x12a),_0x2fbd06(0xf1),_0x2fbd06(0xe1)));}else{console[_0x2fbd06(0x120)]('No\x20se\x20pudo\x20insertar\x20el\x20pago\x20en\x20portal');const _0x1d3454={'h1':_0x2fbd06(0x106),'p':'No\x20se\x20ejecuto\x20el\x20proceso\x20de\x20alta\x20de\x20pagos\x20en\x20portal,\x20para\x20la\x20compañia\x20'+database[_0x370e7a]+_0x2fbd06(0xf2)+_0x17f4b6[_0x2fbd06(0x11d)][_0x36b0d7]['external_id'],'status':_0x5d7818[_0x2fbd06(0x12e)],'message':_0x5d7818[_0x2fbd06(0x11a)],'position':_0x370e7a,'idCia':database[_0x370e7a]};logGenerator(_0x2fbd06(0x12a),_0x2fbd06(0xf1),_0x2fbd06(0x121)+database[_0x370e7a]+'\x20con\x20el\x20NoPagoSage\x20'+_0x17f4b6[_0x2fbd06(0x11d)][_0x36b0d7][_0x2fbd06(0x112)]),await sendMail(_0x1d3454)[_0x2fbd06(0x107)](_0x3e6d08=>{const _0x8a0ced=_0x2fbd06;console[_0x8a0ced(0x120)](_0x3e6d08),logGenerator(_0x8a0ced(0x12a),_0x8a0ced(0xf1),'Error\x20al\x20enviar\x20el\x20correo\x20de\x20alta\x20de\x20pagos\x20en\x20portal\x20'+_0x3e6d08);});try{notifier[_0x2fbd06(0x118)]({'title':_0x2fbd06(0x123),'message':_0x2fbd06(0x10c)+_0x5d7818[_0x2fbd06(0x11a)],'sound':!![],'wait':!![],'icon':process['cwd']()+'/public/img/cerrar.png'}),logGenerator('PortalPaymentController',_0x2fbd06(0xf1),_0x2fbd06(0x10c)+_0x5d7818[_0x2fbd06(0x11a)]);}catch(_0x4be528){console['log'](_0x4be528),logGenerator(_0x2fbd06(0x12a),_0x2fbd06(0xf1),_0x2fbd06(0x12d)+_0x4be528),console[_0x2fbd06(0x120)](_0x2fbd06(0x10c)+_0x5d7818[_0x2fbd06(0x11a)]);}}}else console[_0x2fbd06(0x120)](_0x2fbd06(0x10f));}else console['log'](_0x2fbd06(0xda));}catch(_0x4a7d80){try{notifier[_0x2fbd06(0x118)]({'title':'Error\x20al\x20ejecutar\x20el\x20proceso\x20de\x20alta\x20de\x20pagos\x20en\x20portal','message':_0x2fbd06(0x10c)+_0x4a7d80,'sound':!![],'wait':!![],'icon':process['cwd']()+_0x2fbd06(0x114)}),logGenerator('PortalPaymentController',_0x2fbd06(0xf1),_0x2fbd06(0x10c)+_0x4a7d80);}catch(_0x223083){console[_0x2fbd06(0x120)](_0x223083),logGenerator(_0x2fbd06(0x12a),_0x2fbd06(0xf1),_0x2fbd06(0x12d)+_0x223083);}}}module[_0x1f3e27(0x104)]={'uploadPayments':uploadPayments};
