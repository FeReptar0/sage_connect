function _0x522f(_0x270aa4,_0x527bcc){const _0x431a77=_0x431a();return _0x522f=function(_0x522f2f,_0x47e69e){_0x522f2f=_0x522f2f-0x1e8;let _0x2dbe01=_0x431a77[_0x522f2f];return _0x2dbe01;},_0x522f(_0x270aa4,_0x527bcc);}const _0x200188=_0x522f;(function(_0xa7a140,_0x50270d){const _0x5778b2=_0x522f,_0x47e4b5=_0xa7a140();while(!![]){try{const _0x54e8cd=-parseInt(_0x5778b2(0x1f7))/0x1*(-parseInt(_0x5778b2(0x1fe))/0x2)+-parseInt(_0x5778b2(0x20a))/0x3+-parseInt(_0x5778b2(0x21d))/0x4+-parseInt(_0x5778b2(0x1ee))/0x5+parseInt(_0x5778b2(0x212))/0x6*(-parseInt(_0x5778b2(0x1ec))/0x7)+-parseInt(_0x5778b2(0x1ef))/0x8+parseInt(_0x5778b2(0x21f))/0x9;if(_0x54e8cd===_0x50270d)break;else _0x47e4b5['push'](_0x47e4b5['shift']());}catch(_0x391191){_0x47e4b5['push'](_0x47e4b5['shift']());}}}(_0x431a,0xd1296));const {runQuery}=require(_0x200188(0x210)),{sendMail}=require('../utils/EmailSender'),axios=require(_0x200188(0x206)),notifier=require('node-notifier'),dotenv=require(_0x200188(0x204)),credentials=dotenv['config']({'path':'.env.credentials.focaltec'}),database=[],tenantIds=[],apiKeys=[],apiSecrets=[],url=credentials[_0x200188(0x216)]['URL'],tenantIdValues=credentials[_0x200188(0x216)]['TENANT_ID'][_0x200188(0x222)](','),apiKeyValues=credentials[_0x200188(0x216)]['API_KEY'][_0x200188(0x222)](','),apiSecretValues=credentials[_0x200188(0x216)][_0x200188(0x207)][_0x200188(0x222)](','),databaseValues=credentials[_0x200188(0x216)][_0x200188(0x203)]['split'](',');tenantIds[_0x200188(0x200)](...tenantIdValues),apiKeys[_0x200188(0x200)](...apiKeyValues),apiSecrets['push'](...apiSecretValues),database['push'](...databaseValues);async function uploadPayments(_0x4f4a30){const _0x4226cc=_0x200188;try{const _0x5bccc1=new Date()[_0x4226cc(0x225)]()[_0x4226cc(0x21a)](0x0,0xa)[_0x4226cc(0x214)](/-/g,''),_0x5cefa3=_0x4226cc(0x209)+_0x5bccc1+_0x4226cc(0x1f1),_0x4ef0bd=await runQuery(_0x5cefa3,database[_0x4f4a30])['catch'](_0x29d9dc=>{const _0x12ac56=_0x4226cc;return console[_0x12ac56(0x205)](_0x29d9dc),{'recordset':[]};}),_0x40add8='SELECT\x20NoPagoSage\x20FROM\x20fesa.dbo.fesaPagosFocaltec',_0x206d04=await runQuery(_0x40add8)['catch'](_0x4db602=>{const _0x593d92=_0x4226cc;return console[_0x593d92(0x205)](_0x4db602),{'recordset':[]};});if(_0x206d04[_0x4226cc(0x1f0)][_0x4226cc(0x219)]>0x0)for(let _0x3f8490=0x0;_0x3f8490<_0x206d04[_0x4226cc(0x1f0)]['length'];_0x3f8490++){for(let _0x36215c=0x0;_0x36215c<_0x4ef0bd[_0x4226cc(0x1f0)]['length'];_0x36215c++){_0x206d04['recordset'][_0x3f8490]['NoPagoSage']===_0x4ef0bd[_0x4226cc(0x1f0)][_0x36215c]['external_id']&&_0x4ef0bd['recordset'][_0x4226cc(0x1f4)](_0x36215c,0x1);}}if(_0x4ef0bd[_0x4226cc(0x1f0)][_0x4226cc(0x219)]>0x0)for(let _0x446c9c=0x0;_0x446c9c<_0x4ef0bd[_0x4226cc(0x1f0)][_0x4226cc(0x219)];_0x446c9c++){const _0x11cddf=[],_0x23f70b='SELECT\x20DP.CNTBTCH\x20as\x20LotePago,DP.CNTRMIT\x20as\x20AsientoPago,\x20\x20RTRIM(DP.IDVEND)\x20as\x20IDVEND,\x20RTRIM(DP.IDINVC)\x20AS\x20IDINVC,\x20H.AMTGROSDST\x20AS\x20invoice_amount,\x20DP.DOCTYPE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,\x20CASE\x20H.CODECURN\x20WHEN\x20\x27MXP\x27\x20THEN\x20\x27MXN\x27\x20ELSE\x20H.CODECURN\x20END\x20AS\x20invoice_currency\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,\x20H.EXCHRATEHC\x20\x20AS\x20invoice_exchange_rate\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,\x20DP.AMTPAYM\x20\x20AS\x20payment_amount\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,\x20ISNULL((SELECT\x20RTRIM([VALUE])\x20FROM\x20APIBHO\x20\x20WHERE\x20CNTBTCH\x20=\x20H.CNTBTCH\x20\x20AND\x20CNTITEM\x20=\x20H.CNTITEM\x20AND\x20OPTFIELD\x20=\x20\x27FOLIOCFD\x27),\x27\x27)\x20AS\x20UUID\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20APTCP\x20DP\x20,\x20APIBH\x20H,\x20APIBC\x20C\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20DP.BATCHTYPE\x20=\x27PY\x27\x20AND\x20DP.CNTBTCH=\x20'+_0x4ef0bd[_0x4226cc(0x1f0)][_0x446c9c][_0x4226cc(0x215)]+'\x20AND\x20DP.CNTRMIT\x20=\x20'+_0x4ef0bd['recordset'][_0x446c9c][_0x4226cc(0x218)]+_0x4226cc(0x21c),_0x3298d8=await runQuery(_0x23f70b,database[_0x4f4a30])['catch'](_0x4caf3e=>{return console['log'](_0x4caf3e),{'recordset':[]};});if(_0x3298d8['recordset'][_0x4226cc(0x219)]>0x0){for(let _0x332549=0x0;_0x332549<_0x3298d8[_0x4226cc(0x1f0)][_0x4226cc(0x219)];_0x332549++){const _0x4cc527={'amount':_0x3298d8[_0x4226cc(0x1f0)][_0x332549][_0x4226cc(0x21e)],'currency':_0x3298d8[_0x4226cc(0x1f0)][_0x332549][_0x4226cc(0x223)],'exchange_rate':_0x3298d8['recordset'][_0x332549][_0x4226cc(0x1e8)],'payment_amount':_0x3298d8[_0x4226cc(0x1f0)][_0x332549][_0x4226cc(0x21e)],'payment_currency':_0x4ef0bd[_0x4226cc(0x1f0)][_0x446c9c][_0x4226cc(0x1ed)],'uuid':_0x3298d8[_0x4226cc(0x1f0)][_0x332549][_0x4226cc(0x1f3)]};_0x11cddf['push'](_0x4cc527);}const _0x36048b=_0x4ef0bd[_0x4226cc(0x1f0)][_0x446c9c][_0x4226cc(0x226)][_0x4226cc(0x1f9)](),_0x283e14=_0x36048b[_0x4226cc(0x21a)](0x0,0x4)+'-'+_0x36048b[_0x4226cc(0x21a)](0x4,0x6)+'-'+_0x36048b[_0x4226cc(0x21a)](0x6,0x8)+_0x4226cc(0x1f2),_0x42565b={'bank_account_id':_0x4ef0bd['recordset'][_0x446c9c][_0x4226cc(0x1eb)],'cfdis':_0x11cddf,'comments':_0x4ef0bd[_0x4226cc(0x1f0)][_0x446c9c][_0x4226cc(0x227)],'currency':_0x4ef0bd[_0x4226cc(0x1f0)][_0x446c9c][_0x4226cc(0x1ed)],'external_id':_0x4ef0bd['recordset'][_0x446c9c]['external_id'],'ignore_amounts':![],'mark_existing_cfdi_as_payed':!![],'open':![],'operation_type':_0x4ef0bd[_0x4226cc(0x1f0)][_0x446c9c][_0x4226cc(0x213)],'payment_date':_0x283e14,'provider_external_id':_0x4ef0bd[_0x4226cc(0x1f0)][_0x446c9c]['provider_external_id'],'reference':_0x4ef0bd[_0x4226cc(0x1f0)][_0x446c9c][_0x4226cc(0x211)],'total_amount':_0x4ef0bd['recordset'][_0x446c9c][_0x4226cc(0x20b)]},_0x5866d6=await axios['post'](url+_0x4226cc(0x20e)+tenantIds[_0x4f4a30]+_0x4226cc(0x1fc),_0x42565b,{'headers':{'PDPTenantKey':apiKeys[_0x4f4a30],'PDPTenantSecret':apiSecrets[_0x4f4a30]}})[_0x4226cc(0x221)](_0x494591=>{return{'status':0x1f4,'data':_0x494591};});if(_0x5866d6['status']===0xc8){const _0x256510='Se\x20ejecuto\x20correctamente\x20el\x20proceso\x20de\x20alta\x20de\x20pagos\x20en\x20portal,\x20para\x20la\x20compaÃ±ia\x20'+database[_0x4f4a30]+_0x4226cc(0x20f)+_0x4ef0bd['recordset'][_0x446c9c][_0x4226cc(0x1f5)],_0x9eb076={'h1':'Alta\x20de\x20pagos\x20en\x20portal','p':_0x4226cc(0x208),'status':_0x5866d6[_0x4226cc(0x224)],'message':_0x256510,'position':_0x4f4a30,'idCia':database[_0x4f4a30]};await sendMail(_0x9eb076)['catch'](_0xd15d9c=>{const _0x495053=_0x4226cc;console[_0x495053(0x205)](_0xd15d9c);});const _0x1f9016='INSERT\x20INTO\x20fesa.dbo.fesaPagosFocaltec\x20(idCia,\x20NoPagoSage)\x20VALUES\x20(\x27'+database[_0x4f4a30]+_0x4226cc(0x201)+_0x4ef0bd[_0x4226cc(0x1f0)][_0x446c9c][_0x4226cc(0x1f5)]+'\x27)',_0x54581a=await runQuery(_0x1f9016)['catch'](_0x4041e3=>{const _0x1c2720=_0x4226cc;return console[_0x1c2720(0x205)](_0x4041e3),{'rowsAffected':[0x0]};});_0x54581a[_0x4226cc(0x220)][0x0]>0x0?console[_0x4226cc(0x205)](_0x4226cc(0x20d)):console['log'](_0x4226cc(0x217));}else{console['log'](_0x4226cc(0x1e9));const _0x4891a4={'h1':_0x4226cc(0x1fb),'p':_0x4226cc(0x1fd),'status':_0x5866d6[_0x4226cc(0x224)],'message':_0x5866d6[_0x4226cc(0x1ea)],'position':_0x4f4a30,'idCia':database[_0x4f4a30]};await sendMail(_0x4891a4)[_0x4226cc(0x221)](_0x233747=>{const _0x5607e9=_0x4226cc;console[_0x5607e9(0x205)](_0x233747);});try{notifier[_0x4226cc(0x1f6)]({'title':_0x4226cc(0x1fa),'message':_0x4226cc(0x1f8)+_0x5866d6[_0x4226cc(0x1ea)],'sound':!![],'wait':!![],'icon':process[_0x4226cc(0x21b)]()+_0x4226cc(0x20c)});}catch(_0x229296){console['log'](_0x229296),console[_0x4226cc(0x205)]('No\x20se\x20ejecuto\x20el\x20proceso:\x20'+_0x5866d6[_0x4226cc(0x1ea)]);}}}else console[_0x4226cc(0x205)](_0x4226cc(0x1ff));}else console[_0x4226cc(0x205)](_0x4226cc(0x202));}catch(_0x27a551){try{notifier['notify']({'title':_0x4226cc(0x1fa),'message':_0x4226cc(0x1f8)+_0x27a551,'sound':!![],'wait':!![],'icon':process[_0x4226cc(0x21b)]()+_0x4226cc(0x20c)});}catch(_0x49a84b){console['log'](_0x49a84b);}}}function _0x431a(){const _0x5c76b9=['invoice_currency','status','toISOString','payment_date','comments','invoice_exchange_rate','No\x20se\x20pudo\x20insertar\x20el\x20pago\x20en\x20portal','data','bank_account_id','37205jmWulf','bk_currency','2816750rhLOTK','1698272MHgMOB','recordset','\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20P.DOCNBR\x20NOT\x20IN\x20(SELECT\x20NoPagoSage\x20FROM\x20fesa.dbo.fesaPagosFocaltec\x20WHERE\x20idCia\x20=\x20P.AUDTORG\x20AND\x20\x20NoPagoSage\x20=\x20P.DOCNBR\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20P.DOCNBR\x20NOT\x20IN\x20(SELECT\x20IDINVC\x20FROM\x20APPYM\x20WHERE\x20IDBANK\x20=\x20B.IDBANK\x20AND\x20CNTBTCH\x20=\x20P.CNTBTCH\x20AND\x20CNTITEM\x20=P.CNTENTR\x20AND\x20SWCHKCLRD\x20=\x202\x20)','T10:00:00.000Z','UUID','splice','external_id','notify','219164xEgLue','No\x20se\x20ejecuto\x20el\x20proceso:\x20','toString','Error\x20al\x20ejecutar\x20el\x20proceso\x20de\x20alta\x20de\x20pagos\x20en\x20portal','Alta\x20de\x20pagos\x20en\x20portal','/payments','No\x20se\x20ejecuto\x20el\x20proceso\x20de\x20alta\x20de\x20pagos\x20en\x20portal','2KEwAHG','No\x20hay\x20facturas\x20pagadas\x20para\x20subir\x20a\x20portal','push','\x27,\x20\x27','No\x20hay\x20pagos\x20para\x20subir\x20a\x20portal','DATABASES','dotenv','log','axios','API_SECRET','Se\x20ejecuto\x20el\x20proceso\x20de\x20alta\x20de\x20pagos\x20en\x20portal','SELECT\x20P.CNTBTCH\x20as\x20LotePago,\x20P.CNTENTR\x20as\x20AsientoPago,\x20RTRIM(BK.ADDR1)\x20AS\x20bank_account_id,\x20B.IDBANK,\x20P.DATEBUS\x20as\x20FechaAsentamiento\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20P.DOCNBR\x20as\x20external_id,P.TEXTRMIT\x20AS\x20comments,\x20P.TXTRMITREF\x20AS\x20reference\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20CASE\x20BK.CURNSTMT\x20WHEN\x20\x27MXP\x27\x20THEN\x20\x27MXN\x27\x20ELSE\x20BK.CURNSTMT\x20END\x20AS\x20bk_currency\x0a\x20\x20\x20\x20\x20\x20\x20\x20,P.DATERMIT\x20as\x20payment_date,\x20RTRIM(P.IDVEND)\x20as\x20provider_external_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20P.AMTRMIT\x20as\x20total_amount\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20\x27TRANSFER\x27\x20as\x20operation_type\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20P.RATEEXCHHC\x20as\x20TipoCambioPago\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20ISNULL((SELECT\x20[VALUE]\x20FROM\x20APVENO\x20WHERE\x20OPTFIELD\x20=\x27RFC\x27\x20AND\x20VENDORID\x20=\x20P.IDVEND\x20),\x27\x27)\x20AS\x20RFC\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20APBTA\x20B,\x20BKACCT\x20BK,\x20APTCR\x20P\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20B.IDBANK\x20=\x20BK.BANK\x20\x20AND\x20B.PAYMTYPE\x20=\x20P.BTCHTYPE\x20AND\x20B.CNTBTCH\x20=\x20P.CNTBTCH\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20P.ERRENTRY\x20=\x200\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20B.PAYMTYPE=\x27PY\x27\x20AND\x20B.BATCHSTAT\x20=\x203\x20AND\x20P.DATEBUS>=','2653245MqlHWM','total_amount','/public/img/cerrar.png','Se\x20inserto\x20correctamente\x20el\x20pago\x20en\x20la\x20tabla\x20fesaPagosFocaltec','/api/1.0/extern/tenants/','\x20con\x20el\x20NoPagoSage\x20','../utils/SQLServerConnection','reference','1626vLeUbU','operation_type','replace','LotePago','parsed','No\x20se\x20inserto\x20el\x20pago\x20en\x20la\x20tabla\x20fesaPagosFocaltec','AsientoPago','length','slice','cwd','\x20AND\x20DP.DOCTYPE\x20=\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20H.ORIGCOMP=\x27\x27\x20AND\x20DP.IDVEND\x20=\x20H.IDVEND\x20\x20AND\x20DP.IDINVC\x20=\x20H.IDINVC\x20\x20AND\x20H.ERRENTRY\x20=\x200\x20AND\x20H.CNTBTCH\x20=\x20C.CNTBTCH\x20AND\x20C.BTCHSTTS\x20=\x203','4728656DXbOwj','payment_amount','44281260SWngjp','rowsAffected','catch','split'];_0x431a=function(){return _0x5c76b9;};return _0x431a();}module['exports']={'uploadPayments':uploadPayments};