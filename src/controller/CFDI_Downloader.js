function _0xe23d(_0x2e3a85,_0x6a9c27){const _0x5400c9=_0x5400();return _0xe23d=function(_0xe23dc9,_0x5da806){_0xe23dc9=_0xe23dc9-0x156;let _0x533c3a=_0x5400c9[_0xe23dc9];return _0x533c3a;},_0xe23d(_0x2e3a85,_0x6a9c27);}const _0x5e57cf=_0xe23d;(function(_0x19308f,_0x33860d){const _0x30c18c=_0xe23d,_0x2542fd=_0x19308f();while(!![]){try{const _0x3ad694=parseInt(_0x30c18c(0x1ba))/0x1*(parseInt(_0x30c18c(0x15f))/0x2)+-parseInt(_0x30c18c(0x1b6))/0x3+-parseInt(_0x30c18c(0x1c1))/0x4*(parseInt(_0x30c18c(0x1a4))/0x5)+parseInt(_0x30c18c(0x183))/0x6*(parseInt(_0x30c18c(0x17d))/0x7)+parseInt(_0x30c18c(0x18a))/0x8+-parseInt(_0x30c18c(0x158))/0x9*(parseInt(_0x30c18c(0x1bc))/0xa)+parseInt(_0x30c18c(0x1b3))/0xb*(parseInt(_0x30c18c(0x170))/0xc);if(_0x3ad694===_0x33860d)break;else _0x2542fd['push'](_0x2542fd['shift']());}catch(_0x3d5c04){_0x2542fd['push'](_0x2542fd['shift']());}}}(_0x5400,0x5f3a2));const {getTypeE,getTypeI}=require(_0x5e57cf(0x16e)),axios=require(_0x5e57cf(0x1bb)),dotenv=require(_0x5e57cf(0x199)),credentials=dotenv[_0x5e57cf(0x17a)]({'path':_0x5e57cf(0x162)}),path_env=dotenv[_0x5e57cf(0x17a)]({'path':'.env.path'}),fs=require('fs'),path=require(_0x5e57cf(0x17b)),{runQuery}=require(_0x5e57cf(0x191)),parser=require(_0x5e57cf(0x18b))[_0x5e57cf(0x173)],xmlBuilder=require(_0x5e57cf(0x18b))['Builder'],url=credentials[_0x5e57cf(0x19a)][_0x5e57cf(0x197)],tenantIds=[],apiKeys=[],apiSecrets=[],tenantIdValues=credentials[_0x5e57cf(0x19a)][_0x5e57cf(0x166)][_0x5e57cf(0x175)](','),apiKeyValues=credentials[_0x5e57cf(0x19a)][_0x5e57cf(0x164)][_0x5e57cf(0x175)](','),apiSecretValues=credentials[_0x5e57cf(0x19a)]['API_SECRET'][_0x5e57cf(0x175)](',');tenantIds[_0x5e57cf(0x18f)](...tenantIdValues),apiKeys['push'](...apiKeyValues),apiSecrets[_0x5e57cf(0x18f)](...apiSecretValues);async function downloadCFDI(_0x10aae6){const _0x2d6f7e=_0x5e57cf,_0x5bb0d3=[],_0x18d164=await getTypeE(_0x10aae6);_0x18d164[_0x2d6f7e(0x1a1)](_0x3a572d=>{const _0x5abc53=_0x2d6f7e;_0x5bb0d3[_0x5abc53(0x18f)]({'cfdiId':_0x3a572d['id'],'providerId':_0x3a572d[_0x5abc53(0x16f)]['provider_id'],'rfcReceptor':_0x3a572d['cfdi']['receptor'][_0x5abc53(0x157)]});});const _0x37e133=await getTypeI(_0x10aae6);_0x37e133['forEach'](_0x3fe81a=>{const _0x4748d8=_0x2d6f7e;_0x5bb0d3[_0x4748d8(0x18f)]({'cfdiId':_0x3fe81a['id'],'providerId':_0x3fe81a[_0x4748d8(0x16f)][_0x4748d8(0x1b5)],'rfcReceptor':_0x3fe81a[_0x4748d8(0x179)][_0x4748d8(0x160)][_0x4748d8(0x157)]});});const _0x33aa69=apiKeys[_0x10aae6],_0x58439e=apiSecrets[_0x10aae6],_0x29cd3b=[],_0x5479e0=[];for(let _0x336f18=0x0;_0x336f18<_0x5bb0d3[_0x2d6f7e(0x195)];_0x336f18++){const _0x2a6a7d=await axios['get'](url+_0x2d6f7e(0x185)+tenantIds[_0x10aae6]+_0x2d6f7e(0x16d)+_0x5bb0d3[_0x336f18][_0x2d6f7e(0x1a0)]+_0x2d6f7e(0x196),{'headers':{'PDPTenantKey':_0x33aa69,'PDPTenantSecret':_0x58439e}});_0x29cd3b[_0x2d6f7e(0x18f)](_0x2a6a7d[_0x2d6f7e(0x159)][_0x2d6f7e(0x190)]);}for(let _0x306100=0x0;_0x306100<_0x29cd3b[_0x2d6f7e(0x195)];_0x306100++){const _0x5d8aa0=path[_0x2d6f7e(0x15a)](_0x29cd3b[_0x306100])[_0x2d6f7e(0x175)]('?')[0x0],_0x423e10=path[_0x2d6f7e(0x19b)](path_env[_0x2d6f7e(0x19a)][_0x2d6f7e(0x16a)],_0x5d8aa0);_0x5479e0[_0x2d6f7e(0x18f)](_0x423e10);const _0x18ffa1=await axios[_0x2d6f7e(0x186)](_0x29cd3b[_0x306100],{'responseType':_0x2d6f7e(0x19e)}),_0x280840=_0x423e10;_0x18ffa1[_0x2d6f7e(0x159)][_0x2d6f7e(0x17f)](fs[_0x2d6f7e(0x194)](_0x423e10))['on']('finish',()=>{const _0x4f8adb=_0x2d6f7e;agregarEtiquetaAddenda(_0x280840,_0x5bb0d3[_0x306100],_0x10aae6),console[_0x4f8adb(0x1a7)](_0x4f8adb(0x1be)+_0x5d8aa0+'\x20descargado');})['on'](_0x2d6f7e(0x19f),_0x32f235=>{const _0x278c2f=_0x2d6f7e;console[_0x278c2f(0x1a7)](_0x278c2f(0x19c)+_0x32f235),fs[_0x278c2f(0x156)](_0x280840,_0x199ad5=>{const _0x582cdc=_0x278c2f;if(_0x199ad5){console[_0x582cdc(0x19f)](_0x582cdc(0x189)+_0x280840+':',_0x199ad5);return;}console[_0x582cdc(0x1a7)](_0x582cdc(0x1be)+_0x280840+_0x582cdc(0x198));});});}}function _0x5400(){const _0x4b8216=['error','cfdiId','forEach','zip_code','value_external_id','110NqPxMM','grupo_fiscal','cuenta_de_gastos','log','municipio','providerId','country','recordset','first_name','Error\x20al\x20escribir\x20el\x20archivo\x20','keys','credit_days','localidad','account','NOT_FOUND','220253NPGaPI','Resultado','provider_id','1561002wMOHlF','field_external_id','SELECT\x20COALESCE(idCia,\x20\x27NOT_FOUND\x27)\x20AS\x20Resultado\x20FROM\x20FESAPARAM\x20WHERE\x20idCia\x20IN\x20(SELECT\x20idCia\x20FROM\x20FESAPARAM\x20WHERE\x20Parametro\x20=\x20\x27RFCReceptor\x27\x20AND\x20Valor\x20=\x20\x27','cfdi:Comprobante','371qgaqfN','axios','104660opydEz','pais','Archivo\x20','clabe','utf8','2796IROQQv','unlink','rfc','576IVLKVg','data','basename','email','/providers/','noExterior','expedient','1550kAUdhn','receptor','grupo_prov','.env.credentials.focaltec','catch','API_KEY','\x27)\x20AND\x20Parametro\x20=\x20\x27DataBase\x27;','TENANT_ID','bank','nombre','city','PATH','colonia','correo','/cfdis/','../utils/GetTypesCFDI','metadata','636ogVKtu','codigoPostal','Error\x20al\x20analizar\x20el\x20archivo\x20','parseString','street','split','toLowerCase','Error\x20al\x20leer\x20el\x20archivo\x20','grupo_de_impuestos','cfdi','config','path','rfcReceptor','7QNwiKr','estado','pipe','No\x20se\x20tienen\x20los\x20datos\x20del\x20banco.\x20Eliminando\x20archivo:','telefono','addresses','821634NuUmep','noInterior','/api/1.0/extern/tenants/','get','exterior_number','bank_accounts','Error\x20al\x20eliminar\x20el\x20archivo\x20','879224cNhZhj','xml2js','state','value','cfdi:Addenda','push','xml','../utils/SQLServerConnection','readFile','Error\x20al\x20ejecutar\x20la\x20consulta:','createWriteStream','length','/files','URL','\x20eliminado\x20exitosamente.','dotenv','parsed','join','Error\x20al\x20descargar\x20el\x20archivo:\x20','grupo_de_proveedores','stream'];_0x5400=function(){return _0x4b8216;};return _0x5400();}function agregarEtiquetaAddenda(_0x58d417,_0x49e38e,_0xaaba75){const _0x2cf149=_0x5e57cf;fs[_0x2cf149(0x192)](_0x58d417,_0x2cf149(0x1c0),async(_0xed4202,_0x5be7f0)=>{const _0xaed59f=_0x2cf149;if(_0xed4202){console['error'](_0xaed59f(0x177)+_0x58d417+':',_0xed4202);return;}const _0x49b059=apiKeys[_0xaaba75],_0x218072=apiSecrets[_0xaaba75],_0x2a21b9=await axios[_0xaed59f(0x186)](url+'/api/1.0/extern/tenants/'+tenantIds[_0xaaba75]+_0xaed59f(0x15c)+_0x49e38e[_0xaed59f(0x1a9)],{'headers':{'PDPTenantKey':_0x49b059,'PDPTenantSecret':_0x218072}}),_0x5a3ad4=_0xaed59f(0x1b8)+_0x49e38e[_0xaed59f(0x17c)]+_0xaed59f(0x165),_0x21f484=await runQuery(_0x5a3ad4)[_0xaed59f(0x163)](()=>{const _0x387f4f=_0xaed59f;return console[_0x387f4f(0x1a7)](_0x387f4f(0x193),_0x5a3ad4),{'recordset':[{'Resultado':_0x387f4f(0x1b2)}]};}),_0x34a20c=_0x21f484[_0xaed59f(0x1ab)][0x0][_0xaed59f(0x1b4)]||'',_0x63391b=_0x2a21b9['data'][_0xaed59f(0x15e)][_0xaed59f(0x188)],_0x4b5558=Object['keys'](_0x63391b)[0x0],_0x1804f2=_0x63391b[_0x4b5558],_0x2dd700=_0x2a21b9[_0xaed59f(0x159)][_0xaed59f(0x15e)][_0xaed59f(0x182)],_0x24cdf4=Object[_0xaed59f(0x1ae)](_0x2dd700)[0x0],_0xdd27a=_0x2dd700[_0x24cdf4],_0x5000bc=_0x2a21b9[_0xaed59f(0x159)][_0xaed59f(0x15e)]['contacts'],_0x496a88=Object[_0xaed59f(0x1ae)](_0x5000bc)[0x0],_0x18db90=_0x5000bc[_0x496a88];if(!_0x1804f2){console[_0xaed59f(0x1a7)](_0xaed59f(0x180),_0x58d417),fs[_0xaed59f(0x156)](_0x58d417,_0x50584c=>{const _0x483636=_0xaed59f;if(_0x50584c){console['error'](_0x483636(0x189)+_0x58d417+':',_0x50584c);return;}console['log'](_0x483636(0x1be)+_0x58d417+_0x483636(0x198));});return;}parser(_0x5be7f0,(_0x49aafd,_0x1cbdfb)=>{const _0x165c88=_0xaed59f;if(_0x49aafd){console[_0x165c88(0x19f)](_0x165c88(0x172)+_0x58d417+':',_0x49aafd);return;}const _0x28b5d7=_0x2a21b9[_0x165c88(0x159)]['expedient']['fields'],_0x28477d=Object[_0x165c88(0x1ae)](_0x28b5d7);let _0x44a10b='',_0x3b5734='',_0x57ec7e='';_0x28477d[_0x165c88(0x1a1)](_0xc3ac2e=>{const _0x522ad2=_0x165c88;_0x28b5d7[_0xc3ac2e][_0x522ad2(0x1b7)]&&_0x28b5d7[_0xc3ac2e][_0x522ad2(0x1b7)][_0x522ad2(0x176)]()==_0x522ad2(0x19d)&&(_0x44a10b=_0x28b5d7[_0xc3ac2e][_0x522ad2(0x1a3)]),_0x28b5d7[_0xc3ac2e][_0x522ad2(0x1b7)]&&_0x28b5d7[_0xc3ac2e][_0x522ad2(0x1b7)][_0x522ad2(0x176)]()==_0x522ad2(0x178)&&(_0x3b5734=_0x28b5d7[_0xc3ac2e]['value_external_id']),_0x28b5d7[_0xc3ac2e][_0x522ad2(0x1b7)]&&_0x28b5d7[_0xc3ac2e][_0x522ad2(0x1b7)]['toLowerCase']()==_0x522ad2(0x1a6)&&(_0x57ec7e=_0x28b5d7[_0xc3ac2e][_0x522ad2(0x1a3)]);});const _0x37e27a={'bank':_0x1804f2?_0x1804f2[_0x165c88(0x18d)]['bank_name']:'','clabe':_0x1804f2?_0x1804f2[_0x165c88(0x18d)][_0x165c88(0x1bf)]:'','account':_0x1804f2?_0x1804f2[_0x165c88(0x18d)][_0x165c88(0x1b1)]:'','grupo_prov':_0x44a10b?_0x44a10b:'','grupo_fiscal':_0x3b5734?_0x3b5734:'','cuenta_contable':_0x57ec7e?_0x57ec7e:''},_0x3010c2={'calle':_0xdd27a?_0xdd27a[_0x165c88(0x18d)][_0x165c88(0x174)]:'','noExterior':_0xdd27a?_0xdd27a[_0x165c88(0x18d)][_0x165c88(0x187)]:'','noInterior':_0xdd27a?_0xdd27a[_0x165c88(0x18d)]['interior_number']:'','colonia':_0xdd27a?_0xdd27a['value']['suburb']:'','localidad':_0xdd27a?_0xdd27a[_0x165c88(0x18d)][_0x165c88(0x169)]:'','municipio':_0xdd27a?_0xdd27a['value'][_0x165c88(0x169)]:'','estado':_0xdd27a?_0xdd27a['value'][_0x165c88(0x18c)]:'','pais':_0xdd27a?_0xdd27a[_0x165c88(0x18d)][_0x165c88(0x1aa)]:'','codigoPostal':_0xdd27a?_0xdd27a[_0x165c88(0x18d)][_0x165c88(0x1a2)]:''},_0x4b99b3={'nombre':_0x18db90?_0x18db90[_0x165c88(0x18d)][_0x165c88(0x1ac)]+'\x20'+_0x18db90[_0x165c88(0x18d)]['last_name']:'','telefono':_0x18db90?_0x18db90[_0x165c88(0x18d)]['phone']:'','correo':_0x18db90?_0x18db90['value'][_0x165c88(0x15b)]:''},_0x1a3445={'cfdi:Addenda':{'cfdi:AddendaEmisor':{'cfdi:Proveedor':{'$':{'IdBase':_0x34a20c,'provider_id':_0x49e38e[_0x165c88(0x1a9)],'external_id':_0x2a21b9[_0x165c88(0x159)]['external_id']||'','bank':_0x37e27a[_0x165c88(0x167)],'clabe':_0x37e27a[_0x165c88(0x1bf)],'account':_0x37e27a[_0x165c88(0x1b1)],'grupo_prov':_0x37e27a[_0x165c88(0x161)],'grupo_fiscal':_0x37e27a[_0x165c88(0x1a5)],'contact':_0x4b99b3[_0x165c88(0x168)],'contact_email':_0x4b99b3[_0x165c88(0x16c)],'contact_phone':_0x4b99b3[_0x165c88(0x181)],'Terminos':_0x2a21b9['data'][_0x165c88(0x1af)]||'30','CuentaContable':_0x37e27a['cuenta_contable'],'TipoProveedor':_0x2a21b9[_0x165c88(0x159)]['type']},'cfdi:DomicilioProv':{'$':{'Calle':_0x3010c2['calle'],'NumeroExterior':_0x3010c2[_0x165c88(0x15d)],'NumeroInterior':_0x3010c2[_0x165c88(0x184)],'Colonia':_0x3010c2[_0x165c88(0x16b)],'Localidad':_0x3010c2[_0x165c88(0x1b0)],'Municipio':_0x3010c2[_0x165c88(0x1a8)],'Estado':_0x3010c2[_0x165c88(0x17e)],'Pais':_0x3010c2[_0x165c88(0x1bd)],'CodigoPostal':_0x3010c2[_0x165c88(0x171)]}}}}}};_0x1cbdfb[_0x165c88(0x1b9)][_0x165c88(0x18e)]=_0x1a3445;const _0x41111e=new xmlBuilder(),_0x5929bf=_0x41111e['buildObject'](_0x1cbdfb);fs['writeFile'](_0x58d417,_0x5929bf,'utf8',_0x2882da=>{const _0x10944f=_0x165c88;if(_0x2882da){console[_0x10944f(0x19f)](_0x10944f(0x1ad)+_0x58d417+':',_0x2882da);return;}console[_0x10944f(0x1a7)]('Archivo\x20'+_0x58d417+'\x20actualizado\x20exitosamente.');});});});}module['exports']={'downloadCFDI':downloadCFDI};