function _0x959b(_0x5f022b,_0x37714f){const _0xeb0bd2=_0xeb0b();return _0x959b=function(_0x959bef,_0x323566){_0x959bef=_0x959bef-0x162;let _0x343fef=_0xeb0bd2[_0x959bef];return _0x343fef;},_0x959b(_0x5f022b,_0x37714f);}const _0x15c236=_0x959b;(function(_0x32c3b7,_0x2ee05b){const _0x25952d=_0x959b,_0x5c18b6=_0x32c3b7();while(!![]){try{const _0x55b7fe=-parseInt(_0x25952d(0x17f))/0x1*(parseInt(_0x25952d(0x19e))/0x2)+-parseInt(_0x25952d(0x163))/0x3*(parseInt(_0x25952d(0x1a3))/0x4)+-parseInt(_0x25952d(0x190))/0x5+-parseInt(_0x25952d(0x1cb))/0x6*(-parseInt(_0x25952d(0x1ae))/0x7)+parseInt(_0x25952d(0x19f))/0x8+parseInt(_0x25952d(0x1b7))/0x9*(-parseInt(_0x25952d(0x197))/0xa)+parseInt(_0x25952d(0x19b))/0xb;if(_0x55b7fe===_0x2ee05b)break;else _0x5c18b6['push'](_0x5c18b6['shift']());}catch(_0x507ede){_0x5c18b6['push'](_0x5c18b6['shift']());}}}(_0xeb0b,0xdc386));const {getTypeE,getTypeI}=require(_0x15c236(0x1bf)),axios=require('axios'),dotenv=require('dotenv'),credentials=dotenv[_0x15c236(0x1a9)]({'path':_0x15c236(0x198)}),path_env=dotenv[_0x15c236(0x1a9)]({'path':_0x15c236(0x195)}),fs=require('fs'),path=require(_0x15c236(0x173)),{runQuery}=require(_0x15c236(0x174)),parser=require(_0x15c236(0x1b1))['parseString'],xmlBuilder=require(_0x15c236(0x1b1))[_0x15c236(0x1b9)],{logGenerator}=require('../utils/LogGenerator'),url=credentials[_0x15c236(0x1a5)]['URL'],tenantIds=[],apiKeys=[],apiSecrets=[],tenantIdValues=credentials[_0x15c236(0x1a5)]['TENANT_ID'][_0x15c236(0x192)](','),apiKeyValues=credentials['parsed'][_0x15c236(0x18b)]['split'](','),apiSecretValues=credentials[_0x15c236(0x1a5)][_0x15c236(0x19a)][_0x15c236(0x192)](',');tenantIds[_0x15c236(0x19d)](...tenantIdValues),apiKeys[_0x15c236(0x19d)](...apiKeyValues),apiSecrets[_0x15c236(0x19d)](...apiSecretValues);async function downloadCFDI(_0x386bd7){const _0x253a0d=_0x15c236,_0x120e58=[],_0x30efd8=await getTypeE(_0x386bd7);_0x30efd8[_0x253a0d(0x1b5)](_0x45d022=>{const _0x4b6879=_0x253a0d;_0x120e58['push']({'cfdiId':_0x45d022['id'],'providerId':_0x45d022[_0x4b6879(0x1ca)]['provider_id'],'rfcReceptor':_0x45d022[_0x4b6879(0x178)][_0x4b6879(0x177)]['rfc']});});const _0x112a69=await getTypeI(_0x386bd7);_0x112a69[_0x253a0d(0x1b5)](_0x3b30ac=>{const _0x1d4afe=_0x253a0d;_0x120e58['push']({'cfdiId':_0x3b30ac['id'],'providerId':_0x3b30ac['metadata']['provider_id'],'rfcReceptor':_0x3b30ac['cfdi'][_0x1d4afe(0x177)][_0x1d4afe(0x196)]});});const _0x1f0c31=apiKeys[_0x386bd7],_0x52206d=apiSecrets[_0x386bd7],_0x9cc134=[],_0x4278ba=[];for(let _0x5ba0e8=0x0;_0x5ba0e8<_0x120e58['length'];_0x5ba0e8++){const _0x24e971=await axios[_0x253a0d(0x167)](url+_0x253a0d(0x17c)+tenantIds[_0x386bd7]+'/cfdis/'+_0x120e58[_0x5ba0e8]['cfdiId']+_0x253a0d(0x1c5),{'headers':{'PDPTenantKey':_0x1f0c31,'PDPTenantSecret':_0x52206d}});_0x9cc134[_0x253a0d(0x19d)](_0x24e971[_0x253a0d(0x172)][_0x253a0d(0x1c7)]);}for(let _0x49c8df=0x0;_0x49c8df<_0x9cc134['length'];_0x49c8df++){const _0x14965d=path[_0x253a0d(0x1c8)](_0x9cc134[_0x49c8df])[_0x253a0d(0x192)]('?')[0x0],_0x47eb7f=path[_0x253a0d(0x17b)](path_env[_0x253a0d(0x1a5)][_0x253a0d(0x1a8)],_0x14965d);_0x4278ba[_0x253a0d(0x19d)](_0x47eb7f);const _0x326d18=await axios[_0x253a0d(0x167)](_0x9cc134[_0x49c8df],{'responseType':_0x253a0d(0x199)}),_0x11c09a=_0x47eb7f;_0x326d18[_0x253a0d(0x172)][_0x253a0d(0x1c1)](fs['createWriteStream'](_0x47eb7f))['on']('finish',()=>{const _0x2d1719=_0x253a0d;agregarEtiquetaAddenda(_0x11c09a,_0x120e58[_0x49c8df],_0x386bd7),console[_0x2d1719(0x16f)]('Archivo\x20'+_0x14965d+_0x2d1719(0x165));})['on'](_0x253a0d(0x1bd),_0x257391=>{const _0x1247a3=_0x253a0d;console[_0x1247a3(0x16f)]('Error\x20al\x20descargar\x20el\x20archivo:\x20'+_0x257391),logGenerator(_0x1247a3(0x175),_0x1247a3(0x1bd),_0x1247a3(0x162)+_0x257391),fs[_0x1247a3(0x183)](_0x11c09a,_0x3142c6=>{const _0x4a4a6a=_0x1247a3;if(_0x3142c6){console[_0x4a4a6a(0x1bd)]('Error\x20al\x20eliminar\x20el\x20archivo\x20'+_0x11c09a+':',_0x3142c6),logGenerator('Error\x20al\x20eliminar\x20el\x20archivo\x20'+_0x11c09a+':',_0x4a4a6a(0x1bd),_0x3142c6);return;}console['log']('Archivo\x20'+_0x11c09a+_0x4a4a6a(0x171));});});}}function agregarEtiquetaAddenda(_0x1c18fa,_0x4adf24,_0x47bdce){const _0xde5078=_0x15c236;fs[_0xde5078(0x184)](_0x1c18fa,_0xde5078(0x1a2),async(_0x44dd70,_0x4167f8)=>{const _0x55d6a1=_0xde5078;if(_0x44dd70){console[_0x55d6a1(0x1bd)](_0x55d6a1(0x170)+_0x1c18fa+':',_0x44dd70),logGenerator(_0x55d6a1(0x170)+_0x1c18fa+':',_0x55d6a1(0x1bd),_0x44dd70);return;}const _0x50ef98=apiKeys[_0x47bdce],_0x3f2a2e=apiSecrets[_0x47bdce],_0x1cd1ab=await axios[_0x55d6a1(0x167)](url+'/api/1.0/extern/tenants/'+tenantIds[_0x47bdce]+_0x55d6a1(0x1bb)+_0x4adf24[_0x55d6a1(0x1c9)],{'headers':{'PDPTenantKey':_0x50ef98,'PDPTenantSecret':_0x3f2a2e}}),_0x28c32e='SELECT\x20COALESCE(idCia,\x20\x27NOT_FOUND\x27)\x20AS\x20Resultado\x20FROM\x20FESAPARAM\x20WHERE\x20idCia\x20IN\x20(SELECT\x20idCia\x20FROM\x20FESAPARAM\x20WHERE\x20Parametro\x20=\x20\x27RFCReceptor\x27\x20AND\x20Valor\x20=\x20\x27'+_0x4adf24[_0x55d6a1(0x193)]+_0x55d6a1(0x17e),_0x5ec735=await runQuery(_0x28c32e)[_0x55d6a1(0x1c4)](()=>{const _0x5f1de0=_0x55d6a1;return console['log'](_0x5f1de0(0x19c),_0x28c32e),logGenerator(_0x5f1de0(0x175),_0x5f1de0(0x1bd),'Error\x20al\x20ejecutar\x20la\x20consulta:\x20'+_0x28c32e),{'recordset':[{'Resultado':_0x5f1de0(0x16b)}]};}),_0x5882e2=_0x5ec735[_0x55d6a1(0x16c)][0x0][_0x55d6a1(0x168)]||'',_0x30b18b=_0x1cd1ab[_0x55d6a1(0x172)][_0x55d6a1(0x166)]['bank_accounts'],_0x16f228=Object[_0x55d6a1(0x1b6)](_0x30b18b)[0x0],_0xe43ba1=_0x30b18b[_0x16f228],_0x5859d1=_0x1cd1ab['data'][_0x55d6a1(0x166)][_0x55d6a1(0x187)],_0x25154b=Object[_0x55d6a1(0x1b6)](_0x5859d1)[0x0],_0x205b63=_0x5859d1[_0x25154b],_0x5775b6=_0x1cd1ab[_0x55d6a1(0x172)][_0x55d6a1(0x166)][_0x55d6a1(0x186)],_0x4bc55d=Object[_0x55d6a1(0x1b6)](_0x5775b6)[0x0],_0x25ae7a=_0x5775b6[_0x4bc55d];if(!_0xe43ba1){console['log'](_0x55d6a1(0x1a7),_0x1c18fa),logGenerator(_0x55d6a1(0x175),_0x55d6a1(0x1bd),_0x55d6a1(0x189)+_0x1c18fa),fs[_0x55d6a1(0x183)](_0x1c18fa,_0x4fc661=>{const _0x4ea4a7=_0x55d6a1;if(_0x4fc661){console[_0x4ea4a7(0x1bd)](_0x4ea4a7(0x1c0)+_0x1c18fa+':',_0x4fc661),logGenerator(_0x4ea4a7(0x1c0)+_0x1c18fa+':',_0x4ea4a7(0x1bd),_0x4fc661);return;}console[_0x4ea4a7(0x16f)]('Archivo\x20'+_0x1c18fa+'\x20eliminado\x20exitosamente.');});return;}parser(_0x4167f8,(_0x325105,_0x38704a)=>{const _0x275413=_0x55d6a1;if(_0x325105){console[_0x275413(0x1bd)](_0x275413(0x1ba)+_0x1c18fa+':',_0x325105),logGenerator(_0x275413(0x1ba)+_0x1c18fa+':',_0x275413(0x1bd),_0x325105);return;}const _0x369444=_0x1cd1ab['data']['expedient'][_0x275413(0x1a0)],_0x2c11d0=Object[_0x275413(0x1b6)](_0x369444);let _0x2139f0='',_0x50df47='',_0x37ba76='';_0x2c11d0[_0x275413(0x1b5)](_0x327a40=>{const _0x1776b8=_0x275413;_0x369444[_0x327a40][_0x1776b8(0x180)]&&_0x369444[_0x327a40][_0x1776b8(0x180)][_0x1776b8(0x1b0)]()==_0x1776b8(0x18e)&&(_0x2139f0=_0x369444[_0x327a40][_0x1776b8(0x1be)]),_0x369444[_0x327a40][_0x1776b8(0x180)]&&_0x369444[_0x327a40]['field_external_id']['toLowerCase']()==_0x1776b8(0x1b3)&&(_0x50df47=_0x369444[_0x327a40][_0x1776b8(0x1be)]),_0x369444[_0x327a40][_0x1776b8(0x180)]&&_0x369444[_0x327a40]['field_external_id'][_0x1776b8(0x1b0)]()==_0x1776b8(0x1b4)&&(_0x37ba76=_0x369444[_0x327a40][_0x1776b8(0x1be)]);});const _0x5b0ae2={'bank':_0xe43ba1?_0xe43ba1['value'][_0x275413(0x194)]:'','clabe':_0xe43ba1?_0xe43ba1[_0x275413(0x1b8)][_0x275413(0x16d)]:'','account':_0xe43ba1?_0xe43ba1[_0x275413(0x1b8)][_0x275413(0x18a)]:'','grupo_prov':_0x2139f0?_0x2139f0:'','grupo_fiscal':_0x50df47?_0x50df47:'','cuenta_contable':_0x37ba76?_0x37ba76:''},_0x4136cc={'calle':_0x205b63?_0x205b63[_0x275413(0x1b8)][_0x275413(0x17a)]:'','noExterior':_0x205b63?_0x205b63[_0x275413(0x1b8)][_0x275413(0x1af)]:'','noInterior':_0x205b63?_0x205b63['value'][_0x275413(0x1a4)]:'','colonia':_0x205b63?_0x205b63[_0x275413(0x1b8)][_0x275413(0x1aa)]:'','localidad':_0x205b63?_0x205b63[_0x275413(0x1b8)][_0x275413(0x1a1)]:'','municipio':_0x205b63?_0x205b63[_0x275413(0x1b8)][_0x275413(0x1a1)]:'','estado':_0x205b63?_0x205b63[_0x275413(0x1b8)][_0x275413(0x1cd)]:'','pais':_0x205b63?_0x205b63['value'][_0x275413(0x16a)]:'','codigoPostal':_0x205b63?_0x205b63[_0x275413(0x1b8)][_0x275413(0x18d)]:''},_0x1ddb89={'nombre':_0x25ae7a?_0x25ae7a[_0x275413(0x1b8)][_0x275413(0x164)]+'\x20'+_0x25ae7a['value']['last_name']:'','telefono':_0x25ae7a?_0x25ae7a[_0x275413(0x1b8)][_0x275413(0x1b2)]:'','correo':_0x25ae7a?_0x25ae7a['value'][_0x275413(0x1c2)]:''},_0x3db87a={'cfdi:Addenda':{'cfdi:AddendaEmisor':{'cfdi:Proveedor':{'$':{'IdBase':_0x5882e2,'provider_id':_0x4adf24[_0x275413(0x1c9)],'external_id':_0x1cd1ab[_0x275413(0x172)][_0x275413(0x191)]||'','bank':_0x5b0ae2['bank'],'clabe':_0x5b0ae2[_0x275413(0x16d)],'account':_0x5b0ae2['account'],'grupo_prov':_0x5b0ae2['grupo_prov'],'grupo_fiscal':_0x5b0ae2['grupo_fiscal'],'contact':_0x1ddb89['nombre'],'contact_email':_0x1ddb89[_0x275413(0x182)],'contact_phone':_0x1ddb89[_0x275413(0x188)],'Terminos':_0x1cd1ab[_0x275413(0x172)][_0x275413(0x1cc)]||'30','CuentaContable':_0x5b0ae2[_0x275413(0x185)],'TipoProveedor':_0x1cd1ab['data'][_0x275413(0x1c6)]},'cfdi:DomicilioProv':{'$':{'Calle':_0x4136cc[_0x275413(0x1ab)],'NumeroExterior':_0x4136cc[_0x275413(0x1a6)],'NumeroInterior':_0x4136cc[_0x275413(0x169)],'Colonia':_0x4136cc[_0x275413(0x1c3)],'Localidad':_0x4136cc[_0x275413(0x18f)],'Municipio':_0x4136cc[_0x275413(0x176)],'Estado':_0x4136cc[_0x275413(0x179)],'Pais':_0x4136cc[_0x275413(0x18c)],'CodigoPostal':_0x4136cc[_0x275413(0x181)]}}}}}};_0x38704a['cfdi:Comprobante']['cfdi:Addenda']=_0x3db87a;const _0x522a7e=new xmlBuilder(),_0x1c093a=_0x522a7e[_0x275413(0x1ad)](_0x38704a);fs[_0x275413(0x1ac)](_0x1c18fa,_0x1c093a,_0x275413(0x1a2),_0x41b4af=>{const _0x5742a3=_0x275413;if(_0x41b4af){console[_0x5742a3(0x1bd)](_0x5742a3(0x16e)+_0x1c18fa+':',_0x41b4af),logGenerator(_0x5742a3(0x16e)+_0x1c18fa+':',_0x5742a3(0x1bd),_0x41b4af);return;}console['log'](_0x5742a3(0x1bc)+_0x1c18fa+_0x5742a3(0x17d));});});});}function _0xeb0b(){const _0x197b26=['API_SECRET','36180430EnPFNI','Error\x20al\x20ejecutar\x20la\x20consulta:','push','105398EYQndi','196792qfYoaJ','fields','city','utf8','140kYGtjG','interior_number','parsed','noExterior','No\x20se\x20tienen\x20los\x20datos\x20del\x20banco.\x20Eliminando\x20archivo:','PATH','config','suburb','calle','writeFile','buildObject','45808rJgOpA','exterior_number','toLowerCase','xml2js','phone','grupo_de_impuestos','cuenta_de_gastos','forEach','keys','46584aZUsgr','value','Builder','Error\x20al\x20analizar\x20el\x20archivo\x20','/providers/','Archivo\x20','error','value_external_id','../utils/GetTypesCFDI','Error\x20al\x20eliminar\x20el\x20archivo\x20','pipe','email','colonia','catch','/files','type','xml','basename','providerId','metadata','1272NxuYDQ','credit_days','state','Error\x20al\x20descargar\x20el\x20archivo:\x20','16881yFiDmZ','first_name','\x20descargado','expedient','get','Resultado','noInterior','country','NOT_FOUND','recordset','clabe','Error\x20al\x20escribir\x20el\x20archivo\x20','log','Error\x20al\x20leer\x20el\x20archivo\x20','\x20eliminado\x20exitosamente.','data','path','../utils/SQLServerConnection','CFDI_Downloader','municipio','receptor','cfdi','estado','street','join','/api/1.0/extern/tenants/','\x20actualizado\x20exitosamente.','\x27)\x20AND\x20Parametro\x20=\x20\x27DataBase\x27;','17rzyqHm','field_external_id','codigoPostal','correo','unlink','readFile','cuenta_contable','contacts','addresses','telefono','No\x20se\x20tienen\x20los\x20datos\x20del\x20banco.\x20Eliminando\x20archivo:\x20','account','API_KEY','pais','zip_code','grupo_de_proveedores','localidad','6724595RSzQdz','external_id','split','rfcReceptor','bank_name','.env.path','rfc','2630MZLmMn','.env.credentials.focaltec','stream'];_0xeb0b=function(){return _0x197b26;};return _0xeb0b();}module['exports']={'downloadCFDI':downloadCFDI};
